#syntax=docker/dockerfile:1

# Build stage with development image
FROM docker/dhi-node:18-dev AS build-stage

ENV NODE_ENV=production
WORKDIR /usr/src/app

# Copy package files and install dependencies
COPY package*.json ./
RUN npm ci --omit=dev

# Runtime stage with the hardened image
FROM docker/dhi-node:18 AS runtime-stage

ENV NODE_ENV=production
WORKDIR /usr/src/app

# Copy node_modules and application code from build stage
COPY --from=build-stage /usr/src/app/node_modules ./node_modules
COPY index.js ./

# Command to run the Node.js application
CMD ["index.js"]